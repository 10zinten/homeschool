{% extends "app_base.html" %}

{% block head_title %}{% endblock %}

{% block main %}
<button id='monthly-button' class="bg-blue-700 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
  Monthly
</button>
<button id='annual-button' class="bg-blue-700 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
  Annual
</button>
{% endblock %}

{% block scripts %}
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    var monthlyPrice = '{{ monthly_price.id }}';
    var annualPrice = '{{ annual_price.id }}';
    var stripePublishableKey = '{{ stripe_publishable_key }}';

    var createCheckoutSession = function (priceId) {
      return fetch("{% url 'subscriptions:create_checkout_session' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({
          price_id: priceId
        })
      }).then(function(result) {
        return result.json();
      });
    };

    var stripe = Stripe(stripePublishableKey);
    document
      .getElementById("monthly-button")
      .addEventListener("click", function(evt) {
        createCheckoutSession(monthlyPrice).then(function(data) {
          stripe.redirectToCheckout({sessionId: data.session_id});
        });
      });

    document
      .getElementById("annual-button")
      .addEventListener("click", function(evt) {
        createCheckoutSession(annualPrice).then(function(data) {
          stripe.redirectToCheckout({sessionId: data.session_id});
        });
      });
  </script>
{% endblock %}
